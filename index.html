<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>弁当配達サービス - 料金計算システム</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #145E4B 0%, #0d4235 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
        }
        
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #F29221;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .header p {
            opacity: 0.95;
            font-size: 15px;
            font-weight: 300;
        }
        
        .form-section {
            padding: 35px;
        }
        
        .step {
            margin-bottom: 30px;
            padding: 25px;
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .step:hover {
            border-color: #F29221;
            box-shadow: 0 6px 20px rgba(242, 146, 33, 0.08);
        }
        
        .step.active {
            border-color: #145E4B;
            box-shadow: 0 6px 20px rgba(20, 94, 75, 0.08);
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .step-number {
            width: 36px;
            height: 36px;
            background: #F29221;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
            font-size: 18px;
        }
        
        .step-title {
            font-size: 20px;
            font-weight: 700;
            color: #000;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }
        
        input[type="text"]:focus, input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #F29221;
            box-shadow: 0 0 0 3px rgba(242, 146, 33, 0.1);
        }
        
        input[type="number"] {
            text-align: center;
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }
        
        .input-group > div {
            flex: 1;
        }
        
        .or-divider {
            padding: 10px;
            color: #999;
            font-size: 14px;
            align-self: center;
        }
        
        .area-status {
            padding: 14px;
            margin-top: 15px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            animation: slideIn 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: 2px solid;
        }
        
        .status-icon {
            font-size: 18px;
            font-weight: bold;
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(-10px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        .area-available {
            background: rgba(20, 94, 75, 0.05);
            color: #145E4B;
            border-color: #145E4B;
        }
        
        .area-unavailable {
            background: rgba(0, 0, 0, 0.05);
            color: #000;
            border-color: #999;
        }
        
        .area-extra {
            background: rgba(242, 146, 33, 0.05);
            color: #F29221;
            border-color: #F29221;
        }
        
        .area-partial {
            background: rgba(20, 94, 75, 0.03);
            color: #145E4B;
            border-color: #145E4B;
        }
        
        .holiday-notice {
            background: rgba(242, 146, 33, 0.08);
            border: 2px solid #F29221;
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #d97d00;
            font-size: 14px;
            font-weight: 600;
        }
        
        .warning-icon {
            font-size: 18px;
            font-weight: bold;
        }
        
        .quick-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .quick-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px 15px;
            background: white;
            color: #145E4B;
            border: 2px solid #145E4B;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quick-btn:hover {
            background: #145E4B;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(20, 94, 75, 0.2);
        }
        
        .quick-btn:active {
            transform: translateY(0);
        }
        
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .day-schedule {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .day-schedule:hover {
            border-color: #F29221;
            box-shadow: 0 4px 12px rgba(242, 146, 33, 0.15);
        }
        
        .day-schedule.has-selection {
            background: rgba(20, 94, 75, 0.02);
            border-color: #145E4B;
        }
        
        .day-name {
            background: #000;
            color: white;
            padding: 10px;
            font-weight: bold;
            text-align: center;
            font-size: 15px;
        }
        
        .day-schedule.has-selection .day-name {
            background: #145E4B;
        }
        
        .meal-inputs {
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .meal-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .meal-row label {
            font-weight: 500;
            margin: 0;
            font-size: 14px;
            width: 40px;
        }
        
        .meal-row input[type="number"] {
            width: 60px;
            padding: 6px;
            font-size: 14px;
            min-width: 0;
        }
        
        .meal-row span {
            font-size: 13px;
            color: #666;
        }
        
        .bento-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        
        .bento-type-option {
            padding: 15px;
            border: 2px solid #e5e5e5;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            background: white;
        }
        
        .bento-type-option:hover {
            border-color: #F29221;
            background: rgba(242, 146, 33, 0.05);
        }
        
        .bento-type-option.selected {
            background: #145E4B;
            color: white;
            border-color: #145E4B;
        }
        
        .bento-name {
            font-weight: 600;
            font-size: 15px;
        }
        
        .food-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        .food-option-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .food-option-group h4 {
            margin-bottom: 10px;
            font-size: 16px;
            color: #333;
        }
        
        .food-option-group select {
            width: 100%;
            padding: 10px;
        }
        
        .disabled-notice {
            color: #999;
            font-size: 12px;
            margin-top: 5px;
            font-style: italic;
        }
        
        .price-display {
            background: linear-gradient(135deg, #145E4B 0%, #0d4235 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 25px;
            position: relative;
            box-shadow: 0 6px 20px rgba(20, 94, 75, 0.15);
        }
        
        .price-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #F29221;
            border-radius: 12px 12px 0 0;
        }
        
        .price-display h3 {
            margin-bottom: 25px;
            font-size: 22px;
            font-weight: 700;
        }
        
        .price-summary {
            background: rgba(255,255,255,0.1);
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
            padding-bottom: 14px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            font-size: 15px;
        }
        
        .price-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .price-label {
            font-weight: 500;
        }
        
        .price-value {
            font-weight: 700;
            font-size: 17px;
        }
        
        .total-section {
            background: rgba(242, 146, 33, 0.15);
            padding: 18px;
            border-radius: 8px;
            margin-top: 15px;
            border: 2px solid rgba(242, 146, 33, 0.3);
        }
        
        .monthly-section {
            background: rgba(255, 255, 255, 0.08);
            padding: 18px;
            border-radius: 8px;
            margin-top: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .monthly-section .price-row {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .monthly-section .price-row:last-child {
            border-bottom: none;
        }
        
        .total-price {
            font-size: 26px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }
        
        .ticket-toggle {
            display: flex;
            align-items: center;
            padding: 18px;
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .ticket-toggle:hover {
            border-color: #F29221;
            box-shadow: 0 4px 12px rgba(242, 146, 33, 0.15);
        }
        
        .ticket-toggle.active {
            background: rgba(242, 146, 33, 0.05);
            border-color: #F29221;
        }
        
        .ticket-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #F29221;
        }
        
        .ticket-toggle label {
            cursor: pointer;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #000;
            font-size: 16px;
        }
        
        .ticket-discount {
            background: #F29221;
            color: white;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 13px;
            font-weight: bold;
        }
        
        .empty-price {
            text-align: center;
            padding: 50px 20px;
            opacity: 0.8;
        }
        
        .empty-price p {
            font-size: 15px;
            line-height: 1.6;
        }
        
        .detail-area {
            font-size: 12px;
            color: inherit;
            margin-top: 5px;
            opacity: 0.9;
        }
        
        .postal-error {
            color: #d32f2f;
            font-size: 13px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>弁当配達サービス - 料金計算システム</h1>
            <p>毎日の美味しいお弁当を、ご自宅までお届けします</p>
        </div>
        
        <div class="form-section">
            <!-- ステップ1: 配達エリア -->
            <div class="step" id="step1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">配達エリアを選択</div>
                </div>
                <div class="input-group">
                    <div>
                        <label for="postalCode">郵便番号で検索</label>
                        <input type="text" id="postalCode" placeholder="例: 1310045" maxlength="7">
                        <div id="postalError" class="postal-error"></div>
                    </div>
                    <div class="or-divider">または</div>
                    <div>
                        <label for="area">区域から選択</label>
                        <select id="area">
                            <option value="">選択してください</option>
                            <option value="edogawa">江戸川区（小松川・平井地域のみ）</option>
                            <option value="katsushika">葛飾区（小菅地区を除く）</option>
                            <option value="koto">江東区（一部地域を除く）</option>
                            <option value="sumida">墨田区（全域）</option>
                            <option value="taito">台東区（全域）</option>
                            <option value="chuo">中央区（全域）＋200円</option>
                            <option value="minato">港区（全域）＋200円</option>
                        </select>
                    </div>
                </div>
                <div id="areaStatus"></div>
            </div>
            
            <!-- ステップ2: 配達スケジュールと数量 -->
            <div class="step" id="step2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">週間配達スケジュールと数量を設定</div>
                </div>
                
                <div class="holiday-notice">
                    <span class="warning-icon">⚠</span>
                    <span>土日祝日は配達を行っておりません。平日のみの配達となります。</span>
                </div>
                
                <div class="quick-buttons">
                    <button type="button" class="quick-btn" onclick="setAllMeals()">すべて1個</button>
                    <button type="button" class="quick-btn" onclick="setLunchOnly()">昼食のみ1個</button>
                    <button type="button" class="quick-btn" onclick="setDinnerOnly()">夕食のみ1個</button>
                    <button type="button" class="quick-btn" onclick="clearAllMeals()">クリア</button>
                </div>
                
                <div class="schedule-grid">
                    <div class="day-schedule" data-day="mon">
                        <div class="day-name">月曜日</div>
                        <div class="meal-inputs">
                            <div class="meal-row">
                                <label>昼食</label>
                                <input type="number" class="meal-count" data-day="mon" data-time="lunch" min="0" max="99" value="0">
                                <span>個</span>
                            </div>
                            <div class="meal-row">
                                <label>夕食</label>
                                <input type="number" class="meal-count" data-day="mon" data-time="dinner" min="0" max="99" value="0">
                                <span>個</span>
                            </div>
                        </div>
                    </div>
                    <div class="day-schedule" data-day="tue">
                        <div class="day-name">火曜日</div>
                        <div class="meal-inputs">
                            <div class="meal-row">
                                <label>昼食</label>
                                <input type="number" class="meal-count" data-day="tue" data-time="lunch" min="0" max="99" value="0">
                                <span>個</span>
                            </div>
                            <div class="meal-row">
                                <label>夕食</label>
                                <input type="number" class="meal-count" data-day="tue" data-time="dinner" min="0" max="99" value="0">
                                <span>個</span>
                            </div>
                        </div>
                    </div>
                    <div class="day-schedule" data-day="wed">
                        <div class="day-name">水曜日</div>
                        <div class="meal-inputs">
                            <div class="meal-row">
                                <label>昼食</label>
                                <input type="number" class="meal-count" data-day="wed" data-time="lunch" min="0" max="99" value="0">
                                <span>個</span>
                            </div>
                            <div class="meal-row">
                                <label>夕食</label>
                                <input type="number" class="meal-count" data-day="wed" data-time="dinner" min="0" max="99" value="0">
                                <span>個</span>
                            </div>
                        </div>
                    </div>
                    <div class="day-schedule" data-day="thu">
                        <div class="day-name">木曜日</div>
                        <div class="meal-inputs">
                            <div class="meal-row">
                                <label>昼食</label>
                                <input type="number" class="meal-count" data-day="thu" data-time="lunch" min="0" max="99" value="0">
                                <span>個</span>
                            </div>
                            <div class="meal-row">
                                <label>夕食</label>
                                <input type="number" class="meal-count" data-day="thu" data-time="dinner" min="0" max="99" value="0">
                                <span>個</span>
                            </div>
                        </div>
                    </div>
                    <div class="day-schedule" data-day="fri">
                        <div class="day-name">金曜日</div>
                        <div class="meal-inputs">
                            <div class="meal-row">
                                <label>昼食</label>
                                <input type="number" class="meal-count" data-day="fri" data-time="lunch" min="0" max="99" value="0">
                                <span>個</span>
                            </div>
                            <div class="meal-row">
                                <label>夕食</label>
                                <input type="number" class="meal-count" data-day="fri" data-time="dinner" min="0" max="99" value="0">
                                <span>個</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ステップ3: 弁当の種類 -->
            <div class="step" id="step3">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">お弁当の種類を選択</div>
                </div>
                <div class="bento-type-grid">
                    <div class="bento-type-option selected" data-type="normal">
                        <div class="bento-name">普通食</div>
                    </div>
                    <div class="bento-type-option" data-type="energy">
                        <div class="bento-name">エネルギー調整食</div>
                    </div>
                    <div class="bento-type-option" data-type="protein">
                        <div class="bento-name">タンパク質調整食</div>
                    </div>
                </div>
                
                <div class="food-options" id="foodOptions">
                    <div class="food-option-group">
                        <h4>ごはんの種類</h4>
                        <select id="riceType">
                            <option value="normal">普通</option>
                            <option value="soft">やわらか</option>
                            <option value="onigiri">おにぎり</option>
                            <option value="okayu">おかゆ</option>
                            <option value="mixer">ミキサー</option>
                        </select>
                        <div class="disabled-notice">※普通食以外は指定できません</div>
                    </div>
                    <div class="food-option-group">
                        <h4>おかずの種類</h4>
                        <select id="sideType">
                            <option value="normal">普通</option>
                            <option value="low-salt">減塩食</option>
                            <option value="chopped-large">大刻み</option>
                            <option value="chopped-small">小刻み</option>
                            <option value="mousse">ムース</option>
                            <option value="mixer">ミキサー</option>
                        </select>
                        <div class="disabled-notice">※普通食以外は指定できません</div>
                    </div>
                </div>
            </div>
            
            <!-- ステップ4: チケット利用 -->
            <div class="step" id="step4">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">お得な割引オプション</div>
                </div>
                <div class="ticket-toggle" id="ticketToggle">
                    <input type="checkbox" id="useTicket">
                    <label for="useTicket">
                        チケットを利用する
                        <span class="ticket-discount">1食100円引き</span>
                    </label>
                </div>
            </div>
            
            <!-- 価格表示 -->
            <div class="price-display" id="priceDisplay">
                <h3>料金明細</h3>
                <div id="priceDetails">
                    <div class="empty-price">
                        <p>配達スケジュールを選択すると<br>料金が表示されます</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 配達可能な郵便番号リスト（実際の郵便番号データ）
        const deliveryPostalCodes = {
            // 江戸川区（小松川・平井地域のみ）
            '1320021': 'edogawa', // 小松川
            '1320025': 'edogawa', // 平井
            '1320035': 'edogawa', // 平井
            
            // 葛飾区（小菅地区1240023を除く全域）
            '1240001': 'katsushika',
            '1240002': 'katsushika',
            '1240003': 'katsushika',
            '1240004': 'katsushika',
            '1240005': 'katsushika',
            '1240006': 'katsushika',
            '1240011': 'katsushika',
            '1240012': 'katsushika',
            '1240013': 'katsushika',
            '1240014': 'katsushika',
            '1240021': 'katsushika',
            '1240022': 'katsushika',
            '1240024': 'katsushika',
            '1250001': 'katsushika',
            '1250002': 'katsushika',
            '1250031': 'katsushika',
            '1250032': 'katsushika',
            '1250033': 'katsushika',
            '1250034': 'katsushika',
            '1250035': 'katsushika',
            '1250041': 'katsushika',
            '1250042': 'katsushika',
            '1250051': 'katsushika',
            '1250052': 'katsushika',
            '1250053': 'katsushika',
            '1250054': 'katsushika',
            '1250061': 'katsushika',
            '1250062': 'katsushika',
            '1250063': 'katsushika',
            
            // 江東区（有明・新木場・夢の島・若洲・青海を除く）
            '1350001': 'koto',
            '1350002': 'koto',
            '1350003': 'koto',
            '1350004': 'koto',
            '1350005': 'koto',
            '1350006': 'koto',
            '1350007': 'koto',
            '1350011': 'koto',
            '1350012': 'koto',
            '1350013': 'koto',
            '1350014': 'koto',
            '1350015': 'koto',
            '1350016': 'koto',
            '1350021': 'koto',
            '1350022': 'koto',
            '1350023': 'koto',
            '1350024': 'koto',
            '1350031': 'koto',
            '1350032': 'koto',
            '1350033': 'koto',
            '1350034': 'koto',
            '1350041': 'koto',
            '1350042': 'koto',
            '1350043': 'koto',
            '1350044': 'koto',
            '1350045': 'koto',
            '1350046': 'koto',
            '1350047': 'koto',
            '1350048': 'koto',
            '1350051': 'koto',
            '1350052': 'koto',
            '1350053': 'koto',
            '1350061': 'koto',
            '1350062': 'koto',
            '1360071': 'koto',
            '1360072': 'koto',
            '1360073': 'koto',
            '1360074': 'koto',
            '1360076': 'koto',
            
            // 墨田区（全域）
            '1300001': 'sumida',
            '1300002': 'sumida',
            '1300003': 'sumida',
            '1300004': 'sumida',
            '1300005': 'sumida',
            '1300011': 'sumida',
            '1300012': 'sumida',
            '1300013': 'sumida',
            '1300014': 'sumida',
            '1300015': 'sumida',
            '1300021': 'sumida',
            '1300022': 'sumida',
            '1300023': 'sumida',
            '1300024': 'sumida',
            '1300025': 'sumida',
            '1300026': 'sumida',
            '1310031': 'sumida',
            '1310032': 'sumida',
            '1310033': 'sumida',
            '1310034': 'sumida',
            '1310041': 'sumida',
            '1310042': 'sumida',
            '1310043': 'sumida',
            '1310044': 'sumida',
            '1310045': 'sumida',
            '1310046': 'sumida',
            
            // 台東区（全域）
            '1100001': 'taito',
            '1100002': 'taito',
            '1100003': 'taito',
            '1100004': 'taito',
            '1100005': 'taito',
            '1100006': 'taito',
            '1100007': 'taito',
            '1100008': 'taito',
            '1100011': 'taito',
            '1100012': 'taito',
            '1100013': 'taito',
            '1100014': 'taito',
            '1100015': 'taito',
            '1100016': 'taito',
            '1110021': 'taito',
            '1110022': 'taito',
            '1110023': 'taito',
            '1110024': 'taito',
            '1110025': 'taito',
            '1110031': 'taito',
            '1110032': 'taito',
            '1110033': 'taito',
            '1110034': 'taito',
            '1110035': 'taito',
            '1110036': 'taito',
            '1110041': 'taito',
            '1110042': 'taito',
            '1110043': 'taito',
            '1110051': 'taito',
            '1110052': 'taito',
            '1110053': 'taito',
            '1110054': 'taito',
            '1110055': 'taito',
            '1110056': 'taito',
            
            // 中央区（全域）
            '1030001': 'chuo',
            '1030002': 'chuo',
            '1030003': 'chuo',
            '1030004': 'chuo',
            '1030005': 'chuo',
            '1030006': 'chuo',
            '1030007': 'chuo',
            '1030008': 'chuo',
            '1030011': 'chuo',
            '1030012': 'chuo',
            '1030013': 'chuo',
            '1030014': 'chuo',
            '1030015': 'chuo',
            '1030016': 'chuo',
            '1030021': 'chuo',
            '1030022': 'chuo',
            '1030023': 'chuo',
            '1030024': 'chuo',
            '1030025': 'chuo',
            '1030026': 'chuo',
            '1030027': 'chuo',
            '1030028': 'chuo',
            '1040031': 'chuo',
            '1040032': 'chuo',
            '1040033': 'chuo',
            '1040041': 'chuo',
            '1040042': 'chuo',
            '1040043': 'chuo',
            '1040044': 'chuo',
            '1040045': 'chuo',
            '1040046': 'chuo',
            '1040051': 'chuo',
            '1040052': 'chuo',
            '1040053': 'chuo',
            '1040054': 'chuo',
            '1040055': 'chuo',
            '1040061': 'chuo',
            
            // 港区（全域）
            '1050001': 'minato',
            '1050002': 'minato',
            '1050003': 'minato',
            '1050004': 'minato',
            '1050011': 'minato',
            '1050012': 'minato',
            '1050013': 'minato',
            '1050014': 'minato',
            '1050021': 'minato',
            '1050022': 'minato',
            '1050023': 'minato',
            '1060031': 'minato',
            '1060032': 'minato',
            '1060041': 'minato',
            '1060044': 'minato',
            '1060045': 'minato',
            '1060046': 'minato',
            '1060047': 'minato',
            '1070051': 'minato',
            '1070052': 'minato',
            '1070061': 'minato',
            '1070062': 'minato',
            '1080071': 'minato',
            '1080072': 'minato',
            '1080073': 'minato',
            '1080074': 'minato',
            '1080075': 'minato',
            '1080023': 'minato',
            '1080014': 'minato'
        };
        
        // 配達エリアの詳細情報
        const areaDetails = {
            'edogawa': {
                name: '江戸川区',
                available: true,
                partial: true,
                details: '小松川・平井地域のみ配達可能',
                extraCharge: 0
            },
            'katsushika': {
                name: '葛飾区',
                available: true,
                partial: true,
                details: '小菅地区を除く全域で配達可能',
                extraCharge: 0
            },
            'koto': {
                name: '江東区',
                available: true,
                partial: true,
                details: '有明・新木場・夢の島・若洲・青海を除く',
                extraCharge: 0
            },
            'sumida': {
                name: '墨田区',
                available: true,
                partial: false,
                details: '全域配達可能',
                extraCharge: 0
            },
            'taito': {
                name: '台東区',
                available: true,
                partial: false,
                details: '全域配達可能',
                extraCharge: 0
            },
            'chuo': {
                name: '中央区',
                available: true,
                partial: false,
                details: '全域配達可能',
                extraCharge: 200
            },
            'minato': {
                name: '港区',
                available: true,
                partial: false,
                details: '全域配達可能',
                extraCharge: 200
            }
        };
        
        // 選択された弁当タイプ
        let selectedBentoType = 'normal';
        
        // 弁当タイプのクリックイベント
        document.querySelectorAll('.bento-type-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.bento-type-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                selectedBentoType = this.dataset.type;
                
                // 普通食以外が選択された場合、ごはんとおかずの選択を無効化
                const riceSelect = document.getElementById('riceType');
                const sideSelect = document.getElementById('sideType');
                
                if (selectedBentoType !== 'normal') {
                    riceSelect.disabled = true;
                    sideSelect.disabled = true;
                    riceSelect.value = 'normal';
                    sideSelect.value = 'normal';
                } else {
                    riceSelect.disabled = false;
                    sideSelect.disabled = false;
                }
                
                calculatePrice();
            });
        });
        
        // チケット利用のトグル
        document.getElementById('useTicket').addEventListener('change', function() {
            const toggleDiv = document.getElementById('ticketToggle');
            if (this.checked) {
                toggleDiv.classList.add('active');
            } else {
                toggleDiv.classList.remove('active');
            }
            calculatePrice();
        });
        
        // 郵便番号から区名を判定する関数
        function getAreaNameFromPostal(postal) {
            const prefix3 = postal.substring(0, 3);
            const prefix4 = postal.substring(0, 4);
            
            // 区名の判定マップ
            const areaMap = {
                '100': '千代田区', '101': '千代田区', '102': '千代田区',
                '103': '中央区', '104': '中央区',
                '105': '港区', '106': '港区', '107': '港区', '108': '港区',
                '110': '台東区', '111': '台東区',
                '112': '文京区', '113': '文京区',
                '114': '北区', '115': '北区',
                '116': '荒川区',
                '120': '足立区', '121': '足立区', '123': '足立区',
                '124': '葛飾区', '125': '葛飾区',
                '130': '墨田区', '131': '墨田区',
                '132': '江戸川区', '133': '江戸川区', '134': '江戸川区',
                '135': '江東区', '136': '江東区',
                '140': '品川区', '141': '品川区', '142': '品川区',
                '143': '大田区', '144': '大田区', '145': '大田区', '146': '大田区',
                '150': '渋谷区', '151': '渋谷区',
                '152': '目黒区', '153': '目黒区',
                '154': '世田谷区', '155': '世田谷区', '156': '世田谷区', '157': '世田谷区', '158': '世田谷区',
                '160': '新宿区', '161': '新宿区', '162': '新宿区', '163': '新宿区',
                '164': '中野区', '165': '中野区',
                '166': '杉並区', '167': '杉並区', '168': '杉並区',
                '169': '新宿区',
                '170': '豊島区', '171': '豊島区',
                '173': '板橋区', '174': '板橋区', '175': '板橋区',
                '176': '練馬区', '177': '練馬区', '178': '練馬区', '179': '練馬区'
            };
            
            // 特定の地域名を判定
            if (postal === '1240023') return '葛飾区小菅';
            if (postal === '1350063') return '江東区有明';
            if (postal === '1350064') return '江東区青海';
            if (postal === '1360081') return '江東区新木場';
            if (postal === '1360082') return '江東区夢の島';
            if (postal === '1360083') return '江東区若洲';
            if (prefix4 === '1320' && postal !== '1320021' && postal !== '1320025' && postal !== '1320035') {
                return '江戸川区（小松川・平井地域外）';
            }
            
            return areaMap[prefix3] || null;
        }
        
        // 郵便番号入力時の処理
        document.getElementById('postalCode').addEventListener('input', function(e) {
            const postal = e.target.value.replace(/[^0-9]/g, '');
            e.target.value = postal;
            const errorDiv = document.getElementById('postalError');
            
            if (postal.length === 7) {
                const areaKey = deliveryPostalCodes[postal];
                const areaName = getAreaNameFromPostal(postal);
                
                if (areaKey) {
                    document.getElementById('area').value = areaKey;
                    checkAreaAvailability(areaKey);
                    errorDiv.textContent = '';
                } else {
                    // 配達エリア外
                    document.getElementById('area').value = '';
                    const statusDiv = document.getElementById('areaStatus');
                    
                    if (areaName) {
                        statusDiv.className = 'area-status area-unavailable';
                        statusDiv.innerHTML = `<span class="status-icon">×</span> ${areaName}は配達エリア外です`;
                        errorDiv.textContent = `${areaName}は配達対象外の地域です`;
                    } else {
                        statusDiv.className = 'area-status area-unavailable';
                        statusDiv.innerHTML = '<span class="status-icon">×</span> この郵便番号は東京23区外または無効な郵便番号です';
                        errorDiv.textContent = '配達対象外の地域です';
                    }
                }
            } else if (postal.length === 0) {
                document.getElementById('areaStatus').innerHTML = '';
                errorDiv.textContent = '';
            }
            
            calculatePrice();
        });
        
        // 区域選択時の処理
        document.getElementById('area').addEventListener('change', function(e) {
            const area = e.target.value;
            document.getElementById('postalError').textContent = '';
            if (area) {
                checkAreaAvailability(area);
            } else {
                document.getElementById('areaStatus').innerHTML = '';
            }
            calculatePrice();
        });
        
        // エリアの配達可否チェック
        function checkAreaAvailability(area) {
            const statusDiv = document.getElementById('areaStatus');
            const areaInfo = areaDetails[area];
            
            if (!areaInfo) {
                statusDiv.className = 'area-status area-unavailable';
                statusDiv.innerHTML = '<span class="status-icon">×</span> 配達エリア外です';
                return;
            }
            
            if (areaInfo.extraCharge > 0) {
                statusDiv.className = 'area-status area-extra';
                statusDiv.innerHTML = `<span class="status-icon">!</span> ${areaInfo.name}は配達可能（追加料金 +${areaInfo.extraCharge}円/食）`;
            } else if (areaInfo.partial) {
                statusDiv.className = 'area-status area-partial';
                statusDiv.innerHTML = `<span class="status-icon">i</span> ${areaInfo.name}は一部地域のみ配達可能<div class="detail-area">${areaInfo.details}</div>`;
            } else {
                statusDiv.className = 'area-status area-available';
                statusDiv.innerHTML = `<span class="status-icon">✓</span> ${areaInfo.name}は配達可能エリアです`;
            }
        }
        
        // 配達数量の変更時
        document.querySelectorAll('.meal-count').forEach(input => {
            input.addEventListener('input', function() {
                const dayElement = this.closest('.day-schedule');
                const lunchCount = parseInt(dayElement.querySelector('[data-time="lunch"]').value) || 0;
                const dinnerCount = parseInt(dayElement.querySelector('[data-time="dinner"]').value) || 0;
                
                if (lunchCount > 0 || dinnerCount > 0) {
                    dayElement.classList.add('has-selection');
                } else {
                    dayElement.classList.remove('has-selection');
                }
                
                calculatePrice();
            });
        });
        
        // ごはん・おかずの種類変更時
        document.getElementById('riceType').addEventListener('change', calculatePrice);
        document.getElementById('sideType').addEventListener('change', calculatePrice);
        
        // 価格計算
        function calculatePrice() {
            const area = document.getElementById('area').value;
            const useTicket = document.getElementById('useTicket').checked;
            
            let totalLunchCount = 0;
            let totalDinnerCount = 0;
            
            // 各曜日の配達数をカウント
            document.querySelectorAll('.meal-count').forEach(input => {
                const count = parseInt(input.value) || 0;
                if (input.dataset.time === 'lunch') {
                    totalLunchCount += count;
                } else {
                    totalDinnerCount += count;
                }
            });
            
            // 基本料金
            const lunchPrice = 700;
            const dinnerPrice = 1000;
            const areaInfo = areaDetails[area];
            const extraCharge = areaInfo ? areaInfo.extraCharge : 0;
            
            // 週間の料金計算
            let weeklyLunchTotal = totalLunchCount * (lunchPrice + extraCharge);
            let weeklyDinnerTotal = totalDinnerCount * (dinnerPrice + extraCharge);
            
            // チケット割引
            let discountAmount = 0;
            if (useTicket) {
                discountAmount = (totalLunchCount + totalDinnerCount) * 100;
                weeklyLunchTotal = totalLunchCount * (lunchPrice + extraCharge - 100);
                weeklyDinnerTotal = totalDinnerCount * (dinnerPrice + extraCharge - 100);
            }
            
            const subtotal = weeklyLunchTotal + weeklyDinnerTotal;
            const tax = Math.floor(subtotal * 0.1);
            const total = subtotal + tax;
            
            // 価格表示の更新
            const priceDetails = document.getElementById('priceDetails');
            if (totalLunchCount > 0 || totalDinnerCount > 0) {
                let html = '<div class="price-summary">';
                
                // 1食あたりの単価表示を追加
                const mealCount = totalLunchCount + totalDinnerCount;
                
                if (totalLunchCount > 0) {
                    const lunchBase = lunchPrice + extraCharge;
                    const lunchFinal = useTicket ? lunchBase - 100 : lunchBase;
                    html += `<div class="price-row">
                        <span class="price-label">昼食 ${totalLunchCount}食/週 × ${lunchFinal}円</span>
                        <span class="price-value">¥${weeklyLunchTotal.toLocaleString()}</span>
                    </div>`;
                }
                
                if (totalDinnerCount > 0) {
                    const dinnerBase = dinnerPrice + extraCharge;
                    const dinnerFinal = useTicket ? dinnerBase - 100 : dinnerBase;
                    html += `<div class="price-row">
                        <span class="price-label">夕食 ${totalDinnerCount}食/週 × ${dinnerFinal}円</span>
                        <span class="price-value">¥${weeklyDinnerTotal.toLocaleString()}</span>
                    </div>`;
                }
                
                if (extraCharge > 0 && !useTicket) {
                    html += `<div class="price-row">
                        <span class="price-label">エリア追加料金</span>
                        <span class="price-value">+¥${extraCharge}/食</span>
                    </div>`;
                }
                
                // 週間合計食数の表示
                html += `<div class="price-row" style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 10px; margin-top: 10px;">
                    <span class="price-label" style="font-weight: 600;">週間合計</span>
                    <span class="price-value">${mealCount}食</span>
                </div>`;
                
                html += '</div>';
                
                if (useTicket) {
                    html += `<div class="price-summary">
                        <div class="price-row">
                            <span class="price-label">チケット割引</span>
                            <span class="price-value" style="color: #90EE90;">-¥${discountAmount.toLocaleString()}</span>
                        </div>
                    </div>`;
                }
                
                html += `<div class="total-section">
                    <div class="price-row">
                        <span class="price-label">小計</span>
                        <span class="price-value">¥${subtotal.toLocaleString()}</span>
                    </div>
                    <div class="price-row">
                        <span class="price-label">消費税（10%）</span>
                        <span class="price-value">¥${tax.toLocaleString()}</span>
                    </div>
                    <div class="total-price">
                        <span>週間合計（税込）</span>
                        <span>¥${total.toLocaleString()}</span>
                    </div>
                </div>`;
                
                // 月間料金の計算と表示
                const monthlyTotal = total * 4;
                const yearlyTotal = total * 52;
                html += `<div class="monthly-section">
                    <div class="price-row">
                        <span class="price-label" style="font-weight: 600;">月間合計（4週間）</span>
                        <span class="price-value" style="font-size: 20px;">¥${monthlyTotal.toLocaleString()}</span>
                    </div>
                    <div class="price-row" style="opacity: 0.8;">
                        <span class="price-label">年間参考額（52週間）</span>
                        <span class="price-value">¥${yearlyTotal.toLocaleString()}</span>
                    </div>
                </div>`;
                
                priceDetails.innerHTML = html;
            } else {
                priceDetails.innerHTML = `
                    <div class="empty-price">
                        <p>配達スケジュールを選択すると<br>料金が表示されます</p>
                    </div>`;
            }
        }
        
        // 一括設定関数
        function setAllMeals() {
            document.querySelectorAll('.meal-count').forEach(input => {
                input.value = 1;
                updateDayScheduleStyle(input);
            });
            calculatePrice();
        }
        
        function setLunchOnly() {
            document.querySelectorAll('.meal-count').forEach(input => {
                if (input.dataset.time === 'lunch') {
                    input.value = 1;
                } else {
                    input.value = 0;
                }
                updateDayScheduleStyle(input);
            });
            calculatePrice();
        }
        
        function setDinnerOnly() {
            document.querySelectorAll('.meal-count').forEach(input => {
                if (input.dataset.time === 'dinner') {
                    input.value = 1;
                } else {
                    input.value = 0;
                }
                updateDayScheduleStyle(input);
            });
            calculatePrice();
        }
        
        function clearAllMeals() {
            document.querySelectorAll('.meal-count').forEach(input => {
                input.value = 0;
                updateDayScheduleStyle(input);
            });
            calculatePrice();
        }
        
        function updateDayScheduleStyle(input) {
            const dayElement = input.closest('.day-schedule');
            const lunchCount = parseInt(dayElement.querySelector('[data-time="lunch"]').value) || 0;
            const dinnerCount = parseInt(dayElement.querySelector('[data-time="dinner"]').value) || 0;
            
            if (lunchCount > 0 || dinnerCount > 0) {
                dayElement.classList.add('has-selection');
            } else {
                dayElement.classList.remove('has-selection');
            }
        }
        
        // 初期表示
        calculatePrice();
    </script>
</body>
</html>
